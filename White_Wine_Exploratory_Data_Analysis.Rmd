---
title: "White Wine Exploratory Data Analysis"
author: "Lekhraj Sharma"
date: "Sept 2015"
output:
  html_document:
    keep_md: yes
    theme: cerulean
    toc: yes
---

```{r, echo=FALSE}
library(ggplot2)
library(psych)
library(gridExtra)
library(memisc)

```

## About

In this exercise, we will explore a data set on white wine quality and physicochemical properties.  The objective is to explore which chemical properties influence the quality of white wines. 

### About the dataset  

Dataset chosen is "White Wine Quality" tidy data set downloaded from [Udacity site](https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityWhites.csv). This publicly availale data set was created by Paulo Cortez, etc in 2009 for white variants of the Portuguese "Vinho Verde" wine. Due to privacy and logistic issues, only physicochemical (inputs) and sensory (the output) variables are available (e.g. there is no data about grape types, wine brand, wine selling price, etc.).

This tidy data set contains 4,898 white wines with 11 variables on quantifying the chemical properties of each wine. At least 3 wine experts rated the quality of each wine, providing a rating between 0 (very bad) and 10 (very excellent).

More information about this data set is available at [Udacity site](https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityInfo.txt)


#### Variable description  

Description of attributes:  

1. **Fixed acidity** (tartaric acid - g / dm^3) : most acids involved with wine or fixed or nonvolatile (do not evaporate readily)  
2. **Volatile acidity** (acetic acid - g / dm^3) : the amount of acetic acid in wine, which at too high of levels can lead to an unpleasant, vinegar taste  
3. **Citric acid** (g / dm^3) : found in small quantities, citric acid can add 'freshness' and flavor to wines  
4. **Residual sugar** (g / dm^3) : the amount of sugar remaining after fermentation stops, it's rare to find wines with less than 1 gram/liter and wines with greater than 45 grams/liter are considered sweet  
5. **Chlorides** (sodium chloride - g / dm^3): the amount of salt in the wine  
6. **Free sulfur dioxide** (mg / dm^3): the free form of SO2 exists in equilibrium between molecular SO2 (as a dissolved gas) and bisulfite ion; it prevents microbial growth and the oxidation of wine  
7. **Total sulfur dioxide** (mg / dm^3): amount of free and bound forms of S02; in low concentrations, SO2 is mostly undetectable in wine, but at free SO2 concentrations over 50 ppm, SO2 becomes evident in the nose and taste of wine  
8. **Density** (g / cm^3): the density of water is close to that of water depending on the percent alcohol and sugar content 
9. **pH**: describes how acidic or basic a wine is on a scale from 0 (very acidic) to 14 (very basic); most wines are between 3-4 on the pH scale  
10. **Sulphates** (potassium sulphate - g / dm3): a wine additive which can contribute to sulfur dioxide gas (S02) levels, wich acts as an antimicrobial and antioxidant  
11. **Alcohol** (% by volume): The percent alcohol content of the wine  
12. **Quality** (score between 0 to 10) : output variable based on sensory data, rating between 0 (very bad) and 10 (very excellent)
   
### Question  

By performing this analysis, we seek to answer the following question:  

1. *Which chemical properties influence the quality of white wines?*

## Load the Data 

Before we can start our data exploration, we need to load the dataset for white wines in a data frame.

```{r echo=FALSE}
wine <- read.csv("./wineQualityWhites.csv")
str(wine)
```

##Summary of the dataset


Let us start with getting basic descriptive statistics about the dataset. We will pay extra attention to **quality** as we are trying to answer question on how can we determine wine quality.


```{r echo=FALSE}
summary(wine)
describe(wine[2:12], skew=F)

```

Both `summary` and `describe` commands give us interesting insights about our attributes. Clearly attribute **X** is just a serial id for each observation. All other attributes except **quality** have a continous value with their mean and median being close, therefore the values are distributed evenly across the total range. **Quality* has discrete values ranging from 3 to 9. 

## Univariate Plots and Analysis

Let us create boxplot for our attributes (leaving **X** out as it is a serial id) to see visually how they are distributed.

```{r echo=FALSE}
par(mfrow=c(3,4))
for (i in 2:length(wine)) {
     boxplot(wine[i], main=names(wine[i])) }

```


Boxplot is confirming what we observed in `summary` that mean and median are close for our attributes here. We can see that other than **alcohol** most other attributes have outliers. We also see that most of the **quality** values lie between 4 to 7.


### Wine quality    

Let us first looking into distribution of quality deeper.

```{r echo=FALSE}
summary(wine$quality)
IQR(wine$quality)
table(wine$quality)
```

So **quality** discrete values range between 3 and 9 with no scores below 3 or above 9. As we saw in earlier boxplot we do have outliers in quality, which is confirmed by seeing that both max and min are more than 1.5*IQR away from their respective quartile. From `table` we can see we have around 4% (200/4898) outliers which is significant. 

Let us plot quality histogram to visualize this better. 

```{r echo=FALSE}
ggplot(data=wine, aes(x=quality)) + geom_bar(binwidth=1, color='black', fill='green') +
  geom_vline(xintercept = mean(wine$quality), linetype= 'longdash', color='red', alpha=.5)+               
  geom_vline(xintercept = median(wine$quality), linetype='longdash', color='blue', alpha=.5) + 
  geom_vline(xintercept = quantile(wine$quality, 0.25) - 1.5 * IQR(wine$quality),
             linetype='dashed', alpha=.5) +
  geom_vline(xintercept = quantile(wine$quality, 0.75) + 1.5 * IQR(wine$quality), 
             linetype='dashed', alpha=.5)
```

We can see that majority of wines have quality scores ranging from 5 to 7. Therefore there are lot more average quality wines and few poor or excellent quality wines. 

## Short questions

### What is the structure of your dataset?
We have a list of 4898 unnamed white wines.  They have all been rated on quality and 13 variables of each wine have been given.  Each value given is numeric other than quality and X which are integers.  The rating scale is from 1-10 but only 3-9 have been used.  A majority of the wines have been rated either 5 or 6. 

### What is/are the main feature(s) of interest in your dataset?
The main feature of interest is the output feature **quality**. We hope to find out what input features can most accurately predict the quality of a wine.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
Based on how we see wines listed and catalogued, it would be good to include **alcohol** and **pH** in our model. Other features which impact the taste such as variety of **acid** related feature may also impact the quality of wine.        

### Did you create any new variables from existing variables in the dataset?
Not so far. But I do it later by creating a new variable to classify wines into bad, average an dgood quality wines.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
We can see that other than **alcohol** most other attributes have outliers. We also see that most of the **quality** values lie between 4 to 7.  Did not make any major adjustments to the structure of the data.   


## Bivariate Plots and Analysis


### Finding attributes which influence quality  

Before we zoom into the set of attributes which impact the **quality** most, let us create paiwise plot for each of the attributes to see in one glance how do not only each of these attributes are distributed but get top level of idea of how they may be related to each other.  


```{r echo=FALSE}
pairs.panels(wine)
```

Our paiwise plot via `pairs.panel` gives us birdeye visual view into how each variable is ditributed along with how they relate to each other. We can see that almost all attributes other than **residual.sugar** and **alcohol** seem to have normal distribution. Both **residual.sugar** and **alcohol** are left skewed and can be converted to normal distribution with some transformations. 

We can see that there are some strong correlation among other attributes such as 0.84 between **density** and **residual.sugar**, which canbe seen in pairwise graph as well in terms almost 45 degree line between these two attributes. Since her ewe are focussing on **quality** relation with other attributes, we are **not** going to explore these relationships by themselves other than in context of attributes that relate to **quality**.

Let us look deeper into these correlations.


```{r echo=FALSE}
lowerCor(wine)
cor.plot(cor(wine))
```

Our correlation plot via `cor.plot` provides are nive visual view with darker shaded color indicated stronger correlation. With this visual cue and looking in pairwise correlation via `lowerCor`, we can see that **quality** has strong correlation with **alcohol** (0.44), **density**(-0.31), **chlorides** (-0.21), **volatile.acidity** (-0.19), **toal.sulfur.dioxide** (-0.17) and bit weaker correlation with **fixed.acidity** (-0.11), **residual.sugar** (-0.10), **pH** (0.10).

We can see that there are some strong correlation among other attributes such as 0.84 between **density** and **residual.sugar**, which can be seen in `cor.plot` as well As in earlier pairwise graph via `pairs.panle` where we see almost a 45 degree line between these two attributes. Since here we are focussing on **quality** relation with other attributes, we are **not** going to explore these relationships by themselves other than in context of attributes that relate to **quality**.

When we look further in pairwise coorelation plot and matrix, we can see that several of the strongly correlated attributes to **quality** have good correlation among themselves. Since we want to identify indepdent variables which impact the quality, it will be good to prune these out and select one with strongest correlation with **quality**. We see that **density** (-0.78), **total.sulphur.dioxide** (-0.45), **chlorides** (-0.36) and **residual.sugar** (-0.45) all have good correlation with our strongly correlated attributed **alcohol**. Simliarly **pH** and **fixed.acidity** also have strong correlation (-0.43), which make sense as pH is measure of acidity on a logarithmic sale.

*Therefore it may suffice to just focus on **alcohol**, **volatile.acidity** and **pH** when modeling a relationship between quaity and chemical attributes of given white wine. We will dive deep into this hypothesis visually and numerically as we progress in this data exploration further.*

Let us start exploring these correlations deeper.


#### Alcohol  

Alcohol has strongest correlation with wine which seems to make sense as typically wine's  perception does relate to alcohol content.

To understand how alcohol may be related to quality, we can ask few questions:
1. How are alcohol values distributed across quality?
2. What is average alcohol content for each quality?
3. Is there a threshold difference in alcohol between poor, average and good quality wine?

Let us answer first question of distribution of alchol versus quality.

```{r echo=FALSE}
tapply(wine$alcohol, wine$quality, mean)
ggplot(data=wine, aes(y=alcohol, x=factor(quality))) +
    geom_boxplot() 
```
We can see that **alcohol** content seems to increase as **quality** level increases for higher quality wines with score of 6 and above.

Let us visualize this deeper with a scatter plot.

```{r echo=FALSE}
ggplot(data=wine, aes(x=quality, y=alcohol)) + geom_jitter(alpha=0.25) +
  geom_smooth(method='lm') 
``` 

We can see a good linear regression line with balanced increasing slope indicating strong linear correlation between **alcohol** and **quality**.

#### Voaltile.Acidity  


```{r echo=FALSE}
tapply(wine$volatile.acidity, wine$quality, mean)
ggplot(data=wine, aes(y=volatile.acidity, x=factor(quality))) + geom_boxplot() 
``` 
We can see that **voaltile.acidity** content seems to decrease as **quality** level increases except for very low or very high quality wines. Therefore alcohol has positive influence on quality of wine.

Let us visualize this deeper with a scatter plot.

```{r echo=FALSE}
ggplot(data=wine, aes(y=volatile.acidity, x=quality)) + geom_jitter(alpha=0.25) +
  geom_smooth(method='lm') 
``` 

We can see a decent linear regression line with decent decreasing slope indicating good linear correlation between **volatile.acidity** and **quality**. Therefore volatile.acidity has negative infulence on quality of wines.

#### pH  

Now let us look at our last attribute **pH**. We can recall from earlier observations that
**pH** is not so strongly correlated as previous two attributes. 

```{r echo=FALSE}
tapply(wine$pH, wine$quality, mean)
ggplot(data=wine, aes(y=pH, x=factor(quality))) + geom_boxplot() 
```
We can see that **pH** content seems to increase as **quality** level increases except for very low quality wines.

Let us visualize this deeper with a scatter plot.

```{r echo=FALSE}
ggplot(data=wine, aes(y=pH, x=quality)) + geom_jitter(alpha=0.25) +
  geom_smooth(method='lm') 
``` 

We can see a average linear regression line with small increasing slope indicating average linear correlation between **pH** and **quality**.

*So overall we see that higher quality wines tend to have higher alcohol and pH but lower level of volatile acid*

### Both Alcohol and Volatile.Acidity together

Since we have stronger correlation of **quality** with **alcohol** and **volatile.acidity**, let us see visually how they impact together.

```{r echo=FALSE}
coplot(quality~alcohol|volatile.acidity, panel=panel.smooth, wine)
``` 

We can see that **alcohol** impacts **quality** in positive way stronger and stronger as **voaltile.acidity** levels increase.


## Short Questions

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?
We can see that **quality** has strong correlation with **alcohol** (0.44), **density**(-0.31), **chlorides** (-0.21), **volatile.acidity** (-0.19), **toal.sulfur.dioxide** (-0.17) and bit weaker correlation with **fixed.acidity** (-0.11), **residual.sugar** (-0.10), **pH** (0.10).


### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?
We can see that there are some very strong correlation among other features such as **density** and **residual.sugar**. We also see that **density** , **total.sulphur.dioxide**, **chlorides** and **residual.sugar** all have good correlation with **alcohol**. Simliarly **pH** and **fixed.acidity** also have strong correlation between them, which make sense as pH is measure of acidity on a logarithmic sale.

### What was the strongest relationship you found?
Strongest correlation is between **density** and **residual.sugar** (0.84).


## Multivariate Plots and Analysis


#### Classifying wine as bad, avergae and good 

Let us classify our wines as following:
-"Bad": Quality score upto 4
-"Avergae": Quality score between 5 and 6
-"Good": Quality score 7 and above

```{r echo=FALSE}
wine$quality.cut <- cut(wine$quality, breaks=c(0,4,6,10), labels=c("Bad Wine", "Average Wine", "Good Wine"))
table(wine$quality.cut)
```

As we can see majority of wines are in **average** category.

Let us visually the relationship between our chosen attributes and quality as sliced by wine quality classification.


```{r echo=FALSE}
ggplot(wine, aes(y=volatile.acidity, x=alcohol, color=quality.cut, size=quality)) + geom_jitter(alpha=0.5)
```

We can see that majority of good wines are in lower right quadrant of the graph, where alcohol content is higher and volatile.acidity is lower. We can further observe that a large cluster of good wine in lower right has alcohol content greater than 11 and volatile.acidity less than 0.45.

```{r echo=FALSE}
ggplot(wine, aes(y=pH, x=alcohol, color=quality.cut, size=quality)) + geom_jitter(alpha=0.5)
```

We can see that majority of good wines are in right half of the graph, where alcohol content is higher and volatile.acidity is middle range. We can further observe that a large cluster of good wine in right half has alcohol content greater than 11 and pH between 2.9 to 3.4.

Now let us try to bring all these together in a single visualization.

```{r echo=FALSE}
ggplot(wine, aes(y=volatile.acidity, x=alcohol, size=pH, color=quality.cut)) + geom_jitter(alpha=0.5)
```

We can see that majority of good wines are in lower right quadrant of the graph, where alcohol content is higher, volatile.acidity is lower and pH is in middle range (middle size symbols). We can further observe that a large cluster of good wine in lower right has alcohol content greater than 10.75, volatile.acidity less than 0.5 and pH between 3 to 3.5.

## Model

Now that we have set of attributes which seem t have good coorelation with quality. We can try to create a model using linear regression.

 quality = C0 + C1 * alcohol + C2 * voaltile.acidity + C3 * pH

```{r echo=FALSE}
m1 <- lm(formula = quality ~ alcohol, data = wine)
m2 <- lm(formula = quality ~ alcohol + volatile.acidity, data = wine)
m3 <- lm(formula = quality ~ alcohol + volatile.acidity + pH, data = wine)
mtable(m1, m2, m3)
```

We can see that we are getting R^2 value of 0.24 with our 3rd model (m3) which models the above linear quality equation with three attributes (alcohol, volatile.acidity and pH). We can slo see that attribute **pH* is not having significant impact as difference in R^2 value between 2nd model (m2) and 3rd model (m3) is quite small.

Let us examine 3rd model deeper.

```{r echo=FALSE}
summary(m3)
coef(m3)
```

We can see that our linear equation is:

 *quality ~ 2.336 + 0.321 * alcohol - 1.965 * voaltile.acidity + 0.223 * pH*
 
We also see that we have good degree of confidence in most of above coefficients except for **pH** whose null-hypothesis probablity seems significant. Large range of residual (min of -3.4 to max of 3.14) as compared to IQR of around 1 with median close to 0.04 seems to suggest some outliers may be spoiling our model. 

Let us look at model visually.

```{r echo=FALSE}
par(mfrow=c(2,2))
plot(m3)
```

We can see that first plot (residual v/s fitted) does indicate close to zero line on avergae with residuals spread out on both sides of this trend line. Simliarly we see in second Q-Q graph that good normal distribution sof residuals as most of them do line except bit on lower and higher side (outliers?). Therefore we can say we our linear model is a decent fit.

Let us visually see how each of attributes impacts the output (quality) in our model.

```{r echo=FALSE}
termplot(m3)
```

We can see that while **alcohol** positively impacts **quality** but **volatile.acidity** negatively impacts **quality**. The **pH** has very small positive impact on **quality**. These results are not surprising and very much in line with our correlation analysis earlier.

# Short Questions

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?
**Alcohol** and **volatile.acidity** strengthened each other to impact the quality of wine.   

### Were there any interesting or surprising interactions between features?
Although not completley surprising **pH* did not influence *quality* as much. Also saw that there was a pattern combination of alcohol and volatile acidity when it came to detrmining quality of wines. Generally higher alcohol and moderate volatile.acidity led to higher quality of white wine.


### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.
Yes, created a linear model that uses the **alcohol**, **volatile.acidity** and **pH** of white wine to predict its quality. Here is th elinear equation the model came up with:

*quality ~ 2.336 + 0.321 * alcohol - 1.965 * voaltile.acidity + 0.223 * pH*

This model is not the strongest and can be improved further. Would like to see R^2 of 0.24 go up further possibly with a polynomial regression (e.g. cubic equation), combination of other features not considered. Several outliers are playing spoilsport in prediction with this model. A larger dataset along with some other attributes which relate better with taste and body of white wine may help further to build a better predictive model.

------

## Final Plots and Summary



### Plot One

```{r echo=FALSE, Plot_One}
pairs.panels(wine)

```

### Description One
------
#### Our paiwise plot via `pairs.panel` gives us birdeye visual view into how each variable is ditributed along with how they relate to each other. We can see that almost all attributes other than **residual.sugar** and **alcohol** seem to have normal distribution. Both **residual.sugar** and **alcohol** are left skewed and can be converted to normal distribution with some transformations. 

### Plot Two
```{r echo=FALSE, Plot_Two}
cor.plot(cor(wine))
```

### Description Two
####DESCRIPTION:  This correlation matrix plot provides are nice visual view with darker shaded color indicated stronger correlation.  We can see that **quality** has strong correlation with **alcohol** (0.44), **density**(-0.31), **chlorides** (-0.21), **volatile.acidity** (-0.19), **toal.sulfur.dioxide** (-0.17) and bit weaker correlation with **fixed.acidity** (-0.11), **residual.sugar** (-0.10), **pH** (0.10).

We also see that **density** (-0.78), **total.sulphur.dioxide** (-0.45), **chlorides** (-0.36) and **residual.sugar** (-0.45) all have good correlation with our strongly correlated attributed **alcohol**. Simliarly **pH** has strong correlation (-0.43) with **fixed.acidity**. Therefore it may suffice to just focus on **alcohol**, **volatile.acidity** and **pH** as set of attributes which have most independent influence on quality of white wine.


### Plot Three

 
```{r echo=FALSE, Plot_Three}
ggplot(data=wine, aes(x=alcohol, y=volatile.acidity, size=quality, color=quality.cut)) +
  geom_jitter(alpha=0.5) + coord_cartesian( 
    xlim=c(quantile(wine$alcohol,.01),quantile(wine$alcohol,.99)),
    ylim=c(quantile(wine$volatile.acidity,.01),quantile(wine$volatile.acidity,.99)) ) +
  geom_vline(xintercept = 10.75, linetype='dashed', color='brown', alpha=0.5) +
  geom_hline(yintercept = 0.5, linetype='dashed', color='brown', alpha=0.5) +  
  ggtitle("Wine Quality: Volatile.Acidity v/s Alcohol")
```

### Description Three
####DESCRIPTION: This is a multivariate plot between **volatile.acidity** and *alcohol** whos epoints are colored and size appropriately with *quality*. This plot provide a good summary visual view of how alcohol and volatile.acidity related to different quality of white wine.

We can summarize following from above plot:

1. **Good Wines (having score above 6)**: *These mostly lie in lower right quadrant (volatile.acidity less than 0.5 and alcohol content larger than 10.75). Therefore good white wine tends to have higher amount of alcohol and moderate to low amount of volatile acid.*

2. **Average Wines (having score from 5 to 6)**: *These mostly lie in lower left quadrant (volatile.acidity less than 0.5 and alcohol content less than 10.75). Therefore average white wine tends to have lower amount of alcohol and moderate to low amount of volatile acid.*

3. **Bad Wines (having score less than 5)**: **These mostly lie in upper left quadrant (volatile.acidity more than 0.5 and alcohol content less than 10.75). Therefore poor quality white wine tends to have lesser amount of alcohol and high amount of volatile acid.*

####So in summary trying to answer our question *Which chemical properties influence the quality of white wines?*, we have found out that **alcohol** and **volatile.acidity** influence our *quality* of wine significantly. We also observed that a large cluster of good wine have alcohol content greater than 10.75 and volatile.acidity less than 0.5.


## Reflections  

Although rating of a wine (quality) by experts is ultimately a subjective matter, we were able to identify fe wpatterns which can help int his regard. While we have been able to find a way to relate quality of white wines with alcohol and volatile acid content, there are certain outliers which indicate that there must be other factors in the play which determine white wine quality. These factors such as smell, taste, soil and climate conditions where grapes were grown, etc, which are not captured in this dataset, may influence the white wine quality.

It will be interesting to see if our observations and model holds good for other kind of white wines outside the region of this dataset came from. There may also be other ways to build a predictive model other than our linear regression model such as polynomial regression, machine learning or SVM, etc.



